% Capítulo 4 - Metodologia
% Implementação
% deve constar o instrumental, os métodos e as técnicas aplicados para a elaboração do trabalho;

\chapter{Capítulo 4}

\section{Implementação}

\subsection{espeak-ng}
Para realizar a normalização de texto, foi utilizado o programa
\emph{open-source} espeak-ng. Nele também é feita a conversão grafema-fonema
(comumente representado pela sigla G2P). O resultado é passado para o programa
desenvolvido neste trabalho.

\subsection{MBROLA}
Baseado no algoritmo PSOLA (Pitch Synchronous Overlap and Add) (descrever PSOLA)
Fonemas/fones simplificados, determinados pelo autor de uma voz, gerando saída
com voz sintetizada. Síntese por dífonos.

\subsubsection{Formato}
Pausas ou fones!!! e duração seguido por um ou mais pares de porcentagem e frequência (Hz)

\subsection{Arquitetura}
Diagrama aqui

\subsection{Módulo de prosódia}
\subsubsection{Sintaxe}
O programa foi codificado em Python em sua versão 3.6.

\subsection{Sintaxe prosódica}
A solução para melhorar a geração prosódica foi adicionar marcações à linguagem
natural, denotando o contorno de acordo com o modelo modelo autossegmental e métrico
Citar SSML (Speech Synthesis Markup Language).

\subsection{Editor gráfico}
Para alterar a prosódia manualmente com maior controle, foi desenvolvido um
editor gráfico utilizando JavaScript. A duração e altura de cada fone pode ser
especificado arrastando barras de controle. O editor se comunica com o espeak-ng
e MBROLA através de um servidor programado em Python utilizando o
\emph{framework} Flask.

\begin{figure}[!htbp]
\centering
\scalebox{0.65}{
    \begin{tikzpicture}[auto, >={Latex[inset=0pt, length=3mm, angle'=28,round]}, box/.style={draw,rounded corners,text width=3.0cm,align=center}]
    \node[] (txt) {Texto};
    \node[box, right=0.7cm of txt] (pre)
        {Pré-processador};
    \node[box, right=0.2cm of pre] (mor)
        {Analisador morfológico};
    \node[box, right=0.2cm of mor] (con)
        {Analisador de contexto};
    \node[box, right=of con] (let)
        {Módulo letra-som};
    \node[box, right=of let] (pro)
        {Gerador de prosódia};
        
    \draw[->] (txt) -- (pre);
        
    \node[box, fit=(pre)(mor)(con), label={[name=morfos_l] Analisador morfossintático}] (morfos) {};
    \node[box, fit=(let)] (letsom) {};
    \node[box, fit=(pro)] (proger) {};
    
    \node[inner sep=0, fit=(morfos)(letsom)(proger)] (all) {};
    \node[box,
          inner sep=0,
          yshift=-0.75cm,
          fit=(morfos.west)(proger.east),
          label=center:Estrutura de dados,
          minimum height=1cm,
          below of=all]
        (dad) {};
    
    \node[box, fit=(morfos)(morfos_l)(letsom)(proger)(dad), label=Processamento de linguagem natural] (nlp) {};
    
    \node[right=of dad, align=left] (out) {\emph{phones}\\ prosódia};
    
    \draw[->] (pre) -- (pre |- dad.north);
    \draw[<->] (mor) -- (mor |- dad.north);
    \draw[<->] (con) -- (con |- dad.north);
    \draw[<->] (let) -- (let |- dad.north);
    \draw[<->] (pro) -- (pro |- dad.north);
    
    \draw[->] (dad) -- (out);
        
    \end{tikzpicture}
}
\caption{Arquitetura de um sistema de geração de prosódia}
\label{fig:nlpdiagram}
\end{figure}