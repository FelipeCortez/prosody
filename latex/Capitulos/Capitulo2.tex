% Capítulo 2 - Contextualização ou definição do problema

% p. 53 paul taylor tem overview dum sistema tts
% p. 14 dutoit tem diagrama
\chapter{Fundamentação teórica}

\section{Prosódia}
\subsection{Componentes}
\citeonline{tts-book} descreve como parâmetros principais da prosódia \emph{pitch},
intensidade e duração. Outros nomes para os mesmos fenômenos também são
utilizados. \citeonline{moraes1998} separa as características principais da
prosódia em \emph{stress}, \emph{accent} e \emph{rhythm}. Como eventos prosódicos estão alinhados a sílabas ou grupos de sílabas, a prosódia é dita um fenômeno suprassegmental. Além desses componentes principais, \citeonline{taylor2009} destaca
\emph{downdrift} (declinação), isto é, a queda gradual do valor de f0 durante um
sintagma como aspecto relevante para a análise entoacional.

\subsection{Função prosódica}
\citeonline{taylor2009} argumenta que uma das dificuldades do desenvolvimento de
um bom modelo de prosódia se deve à falta de consideração da função
comunicativa da fala, isto é, comumente análises são feitas ignorando o contexto
da intenção do locutor. Apresenta, então, três principais funções comunicativas
para prosódia:

\paragraph{Afetiva} Prosódia referente à emoção, estado mental e atitude do
locutor.
% n general, affective prosody has a fairly direct meaning-to-form relationship and hence the more extreme the form the more extreme the emotion. This implies that, unlike verbal language, the affective prosody system is not arbitrary with regard to meaning/form. A number of emotion categorisation systems have been proposed. One common theory holds that there are six basic emotions (anger, happiness, sadness, disgust, fear and surprise) from which follow a number of secondary emotions such as puzzlement or intrigue [110], [113], [153]. Some however argue that there is no fixed set of emotions and rather emotion is best expressed in a multi-dimensional system. One such proposal advocates three independent axes of emotion called activation, evalu- ation and power [393], [126].
% In addition to emotion, affective prosody includes speaker attitude. The difference between emotion and attitude is that only emotion can exist independent of communication. As an illustra- tion; you can be happy on your own, but you need someone else to be sarcastic with. Apart from this distinction, attitude functions similarly to emotion in that it is fairly direct, has a significant degree of universality and does not have a arbitrary or dual nature.
\paragraph{Suprassegmental} Quando uma mensagem é dita de maneira declarativa,
sem conteúdo afetivo significante -- descrita como \emph{discourse neutral} --,
ainda é possível observar variação de \emph{pitch}, intensidade e duração. Na
abordagem de \citeonline{taylor2009}, essa parte da prosódia, dita
suprassegmental, não é considerada conteúdo prosódico verdadeiro, mas sim um
aspecto da fonética verbal. É possível ainda pensar em prosódia ``real'' como
desvios dos parâmetros suprassegmentais.
% If a sentence is spoke with little or no affective content, ie. in a discourse neutral manner, we still see characteristic patterns in the phrasing, rhythm, pitch, voice quality and timing. Typical effects include phones at the ends of sentences or phrases being lengthened, syntactically salient words (e.g. heads) having more emphasis, F0 levels being higher at the starts of sentences and so on.
\paragraph{Aumentativa} Além da prosódia afetiva, é possível desviar da prosódia
padrão para assegurar a comunicação efetiva de uma mensagem sem adicionar
informação ao conteúdo do que está sendo dito. É usada, por exemplo, para
enfatizar palavras, desambiguando uma mensagem que poderia ser interpretada de
diferentes formas.

\subsection{Prosódia como elemento extra-textual}
\citeonline{taylor2009} argumenta que a geração de prosódia afetiva é árdua e
depende de uma compreensão do texto. Ainda fala que, até a data de publicação do
livro, nenhuma solução satisfatória foi encontrada e os sistemas TTS atuais
pecam nesse aspecto.
% Considerando o texto como sequência de palavras, é difícil determinar prosódia
% afetiva.
% Gerar a prosódia certa é uma questão de Natural Language Understanding, isto é,
% é preciso entender o texto para gerar os contornos melódicos afetivos.
% From this we can conclude that in situations where the text genre is quite factual, it is usually sufficient to generate speech from the verbal message only, and so all that is required is the gen- eration of the suprasegmental part of the signal; the affective part of prosody is ignored. In other text genres the situation is significantly more difficult, and if say a dialogue from a play is read in this fashion (or more likely) responses from a computer dialogue system, the generated speech can sound somewhat dull and removed. Finally, we see that mimicking a genuinely good human reader is very difficult indeed, as they will be performing an actual comprehension of the text, and then generating their own prosody. In no way are they simply decoding the prosody from the text and then speaking it aloud, as they can do with the words. To date, no satisfactory solution has been found to this problem, and so current text-to-speech systems are, unfortunately, lacking in this regard.

% \subsection{Contornos melódicos}
% \citeonline{moraes2008} analisa para a mesma frase ``Renata jogava'' utilizando
% o modelo ToBI uma mesma frase falada com intenções diferentes analisando como a
% entoação afeta a intenção percebida.

\section{Sistemas TTS}
\citeonline{ssml} definem \emph{text-to-speech} como ``o processo de geração
automática de fala a partir de texto ou texto anotado'' (tradução nossa). São
utilizados em leitores digitais, assistentes pessoais para \emph{smartphones} e
\emph{smartphones}, aprendizagem de linguagens, entre outros.

Sistemas TTS são compostos por múltiplos subsistemas. Como veremos na seção
\ref{sistemas}, algumas implementações de TTS são modulares, permitindo
desenvolvimento paralelo de cada componente individual. Isso possibilita que
pesquisas possam investigar uma parte específica do sistema, como este trabalho,
que foca no módulo de prosódia.

\subsection{Estrutura}
Na literatura, encontramos diversas arquiteturas específicas para um sistema TTS.
\citeonline{tts-book} propõe uma arquitetura geral, dividindo sistemas em duas partes principais:

\begin{figure}[!htbp]
\centering
\scalebox{0.80}{
    \begin{tikzpicture}[auto, >={Latex[inset=0pt, length=3mm, angle'=28,round]}, box/.style={draw,rounded corners,text width=4.5cm,align=center}]
    \node[] (txt) {Texto};
    \node[box, right=of txt] (nlp)
        {Processamento de linguagem natural};
    \node[box, right=of nlp] (dsp)
        {Processamento digital de sinais};
    \node[right=of dsp] (fal)
        {Fala};

        \node[box, fit=(nlp)(dsp), label=Sistema \emph{text-to-speech}] (tts) {};

    \draw[->] (txt) -- (nlp);
    \draw[->] (nlp) -- (dsp);
    \draw[->] (dsp) -- (fal);
    \end{tikzpicture}
}
\caption{Arquitetura geral de sistemas TTS (adaptado de \citeonline{tts-book})}
\label{fig:tts-arch}
\end{figure}

É comum encontrar em outros trabalhos o termo \emph{front end} para o
bloco de processamento de linguagem natural e \emph{back end} para o bloco de
processamento digital de sinais. Doravante utilizaremos essa nomenclatura.

\subsection{\emph{Front end}}
O \emph{front end} de um sistema TTS é responsável pela conversão do texto em
sua representação em fones juntamente com parâmetros prosódicos. Em outras
palavras, o bloco é responsável por determinar a pronúncia de cada palavra do
texto, incluindo o contorno melódico e ritmo da fala. As definições a seguir são adaptadas de \cite{martinjurafsky}:

\subsubsection{Normalização de texto}
O processo de conversão de texto para fala começa com o processamento do texto a
fim de gerar uma representação grafêmica.

A primeira etapa da normalização é a separação em sintagmas, isto é, encontrar os
limites de cada frase do texto. Frases que terminam com siglas ou abreviações podem dificultar o processo. Em ``Encaminhamos o caso à deliberação de V. Exas. O prazo para resposta é de dez dias.'', por exemplo, o ponto em ``Exas.'' é final, não da abreviação.

Em seguida, devem-se transformar símbolos, abreviações, siglas e outras
\emph{non-standard words} em suas representações pronunciáveis. Como exemplo, ``R\$
50'' deve ser lido como ``cinquenta reais''.

Por último, deve ser realizada a desambiguação de homônimos heterófonos: em
``Gosto de pão'', ``gosto'' pode ser pronunciada como ``gôsto'' ou ``gósto''.

\subsubsection{Conversão grafema-fone}
Com o texto normalizado, é preciso converter letras, isto é, grafemas, em uma
representação pronunciável, ou seja, fones. Para isso, normalmente é composto um
conjunto de regras \emph{letter-to-sound} ou letra-som, contendo as pronúncias
comuns para sequências de letras, juntamente a um dicionário de pronúncia com
palavras que fogem das regras. Para cada palavra, é feita uma busca no
dicionário, e caso não seja encontrada, utilizam-se as regras.
% Palavras não-padrão são colocadas num dicionário de pronúncia. O resto é
% calculado de acordo com regras letra-som.
% Context-dependent e independent. Abordagens por machine learning ou regras.
% A conversão grafema-fone (ou fonema) consiste em transformar o texto normalizado
% em fones, ou seja, uma sequência de caracteres em uma sequência de fones.

\subsubsection{Geração de prosódia}
\label{gerpros}
A partir do texto e fones gerados nas etapas anteriores, deve-se estimar
\emph{pitch}, intensidade e duração. \citeonline {taylor2009} explica que o
desafio para implementação deste componente é que o texto praticamente não
possui informação prosódica.

Possíveis soluções para este problema são discutidas na seção \ref{prosafe}.

% In text-to-speech, our interest is of course to generate prosody from text. This is problematic in that text mostly encodes the verbal component of language; prosody is by and large ignored. Given that prosody is such a vital part of spoken language, how then is it possible that written communication can even work

% decide to use neutral prosody, and the suprasegmental effects that need to be
% synthesised can be found from the verbal part of the message. For more emotive
% messages, or in cases where we think we need significant use of augmentative
% prosody, we have a fairly serious problem. This is because we have no means of
% knowing what prosody the speech should be encoded with; the message that we
% found from the text has no explicit clues as to what the prosody should be.
% (taylor p 37)
%  I wanted to go to London, but could only get tickets for France there seems to be two main intonation phrases, their boundary occurring at the comma
%  there is often a slight drop in F0 from the beginning of an intonation phrase to its end, which resets at the beginning of a new intonation phrase
% A very high-precision rule is the one we saw for sentence segmentation: insert a boundary after punctuation. Another commonly used rule inserts a phrase boundary before a function word following a content word.

\subsection{Back end}
% martin jurasfky p275
Com o texto de entrada transformado em fones e informação prosódica, um
\emph{back end} é responsável por gerar uma forma de onda.
\citeonline{martinjurafsky} separam algoritmos de síntese em três paradigmas:
síntese concatenativa, síntese por formantes e síntese articulatória. 

\paragraph{Síntese articulatória}

\paragraph{Síntese por formantes}

\paragraph{Síntese concatenativa}
Síntese concatenativa pode trabalhar com diferentes atomicidades: nível de palavra,
dífonos e fones individuais.
\end{itemize}

% Intonational phrase: sintagmas entoacionais
% Tone boundary: fronteira prosódica?
% Pitch accent: acento de pitch

% https://www.ime.usp.br/~cpaz/downloads/algorithm-portuguese.pdf

Abordagem utilizada pelo programa MBROLA. Consiste em gravar fala, separar
pedaços de dois em dois.

% http://hts.sp.nitech.ac.jp/
Algumas vozes para o MaryTTS \cite{marytts} utilizam HMMs, isto é, Modelos
ocultos de Markov para \emph{unit selection}. Há, inclusive, uma voz brasileira
feita a partir de HMMs: \cite{couto}.
Projetos mais recentes como \cite{merlin,dnngoogle} utilizam redes neurais para
estimação de parâmetros. O trabalho da Google informa? que a estimação da curva
F0 é uma possível melhoria.
